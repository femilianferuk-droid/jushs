<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monkey Gram - Telegram Web Client</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ====== CSS –°–¢–ò–õ–ò ====== */
        :root {
            --primary: #FF6B35;
            --primary-dark: #E55A2B;
            --primary-light: #FF8B5C;
            --secondary: #4ECDC4;
            --dark: #292F36;
            --darker: #1A1E23;
            --light: #F7FFF7;
            --gray: #6C757D;
            --gray-light: #E9ECEF;
            --gray-dark: #495057;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.2);
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --transition: all 0.3s ease;
            --sidebar-width: 380px;
            --header-height: 60px;
            --input-height: 50px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1e23 0%, #292f36 100%);
            color: var(--light);
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
            background: var(--darker);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        /* ====== –ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨ ====== */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--dark);
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 28px;
            color: var(--light);
            background: rgba(255, 255, 255, 0.2);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-text h1 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(45deg, #fff, #FFD166);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 4px;
        }

        .logo-text p {
            font-size: 12px;
            opacity: 0.8;
            color: var(--light);
        }

        .sidebar-search {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 45px 12px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-sm);
            color: var(--light);
            font-size: 14px;
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
        }

        .search-box i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .chats-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .chat-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
        }

        .chat-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .chat-item.active {
            background: rgba(255, 107, 53, 0.1);
            border-left: 4px solid var(--primary);
        }

        .chat-avatar {
            position: relative;
            margin-right: 15px;
        }

        .avatar-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
        }

        .online-status {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            border: 2px solid var(--dark);
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-name {
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-name span {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chat-time {
            font-size: 12px;
            opacity: 0.7;
            margin-left: 10px;
        }

        .last-message {
            font-size: 14px;
            opacity: 0.8;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .unread-badge {
            background: var(--primary);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: auto;
        }

        /* ====== –û–°–ù–û–í–ù–û–ô –ß–ê–¢ ====== */
        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--darker);
        }

        .chat-header {
            height: var(--header-height);
            padding: 0 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(41, 47, 54, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-status {
            font-size: 13px;
            opacity: 0.7;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .user-status.online {
            color: var(--success);
        }

        .chat-actions {
            display: flex;
            gap: 20px;
        }

        .chat-actions button {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 20px;
            cursor: pointer;
            transition: var(--transition);
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-actions button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%231a1e23' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .date-divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }

        .date-divider span {
            background: rgba(41, 47, 54, 0.8);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 13px;
            color: var(--gray);
            backdrop-filter: blur(5px);
        }

        .message {
            display: flex;
            margin-bottom: 15px;
            max-width: 70%;
            animation: messageAppear 0.3s ease;
        }

        @keyframes messageAppear {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.outgoing {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .message-content {
            padding: 12px 16px;
            border-radius: var(--border-radius-sm);
            position: relative;
            max-width: 100%;
            word-wrap: break-word;
        }

        .message.incoming .message-content {
            background: var(--dark);
            border-top-left-radius: 4px;
        }

        .message.outgoing .message-content {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-top-right-radius: 4px;
        }

        .message-text {
            font-size: 15px;
            line-height: 1.5;
        }

        .message-time {
            font-size: 12px;
            opacity: 0.7;
            text-align: right;
            margin-top: 5px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 5px;
        }

        .message-status {
            font-size: 10px;
        }

        .message-status.read {
            color: #4ECDC4;
        }

        .input-container {
            padding: 20px;
            background: rgba(41, 47, 54, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message-input-wrapper {
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .input-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-actions button {
            background: rgba(255, 255, 255, 0.05);
            border: none;
            color: var(--gray);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .input-actions button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
        }

        .message-input {
            flex: 1;
            position: relative;
        }

        .message-input textarea {
            width: 100%;
            min-height: 50px;
            max-height: 150px;
            padding: 15px 60px 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-sm);
            color: var(--light);
            font-size: 15px;
            resize: none;
            transition: var(--transition);
            font-family: inherit;
        }

        .message-input textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
        }

        .input-send {
            position: absolute;
            right: 15px;
            bottom: 15px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .input-send:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
        }

        /* ====== –≠–ö–†–ê–ù–´ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ====== */
        .auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #1a1e23 0%, #292f36 100%);
            padding: 20px;
        }

        .auth-container {
            background: var(--dark);
            border-radius: var(--border-radius);
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow-lg);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-logo {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .auth-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .auth-header p {
            color: var(--gray);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--light);
        }

        .form-control {
            width: 100%;
            padding: 14px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-sm);
            color: var(--light);
            font-size: 15px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 14px 30px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .auth-footer {
            text-align: center;
            margin-top: 25px;
            color: var(--gray);
            font-size: 14px;
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        .code-inputs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .code-input {
            flex: 1;
            height: 60px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-sm);
            color: var(--light);
            transition: var(--transition);
        }

        .code-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .password-input-wrapper {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 18px;
        }

        .password-toggle:hover {
            color: var(--light);
        }

        /* ====== LOADING & MODALS ====== */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #1a1e23 0%, #292f36 100%);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            color: var(--light);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--dark);
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            transform: translateY(-20px);
            transition: var(--transition);
            box-shadow: var(--shadow-lg);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--light);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 24px;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--light);
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: var(--border-radius-sm);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert-success {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .alert-error {
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .alert-warning {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .alert-info {
            background: rgba(23, 162, 184, 0.1);
            border: 1px solid rgba(23, 162, 184, 0.2);
            color: #17a2b8;
        }

        /* ====== RESPONSIVE ====== */
        @media (max-width: 1200px) {
            .sidebar {
                width: 320px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                bottom: 0;
                z-index: 100;
                width: 100%;
                max-width: 380px;
            }

            .sidebar.active {
                left: 0;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .message {
                max-width: 85%;
            }
        }

        @media (max-width: 480px) {
            .auth-container {
                padding: 25px;
            }

            .chat-header {
                padding: 0 15px;
            }

            .messages-container {
                padding: 15px;
            }

            .input-container {
                padding: 15px;
            }
        }

        /* ====== UTILITY CLASSES ====== */
        .hidden {
            display: none !important;
        }

        .d-flex {
            display: flex;
        }

        .align-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .flex-column {
            flex-direction: column;
        }

        .w-100 {
            width: 100%;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .p-20 {
            padding: 20px;
        }

        .scrollbar-hide {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .emoji-picker {
            position: absolute;
            bottom: 70px;
            right: 20px;
            background: var(--dark);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: 15px;
            width: 300px;
            display: none;
            z-index: 100;
        }

        .emoji-picker.active {
            display: block;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .emoji {
            font-size: 20px;
            cursor: pointer;
            text-align: center;
            padding: 5px;
            border-radius: 5px;
            transition: var(--transition);
        }

        .emoji:hover {
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loadingScreen" class="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ Monkey Gram...</div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="authScreen" class="auth-screen hidden">
        <div class="auth-container">
            <div class="auth-header">
                <div class="auth-logo">
                    <i class="fas fa-monkey"></i>
                </div>
                <h1>Monkey Gram</h1>
                <p>Telegram Web Client —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º</p>
            </div>

            <!-- –§–æ—Ä–º–∞ API –¥–∞–Ω–Ω—ã—Ö -->
            <div id="apiForm">
                <div class="form-group">
                    <label for="apiId">API ID</label>
                    <input type="text" id="apiId" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à API ID">
                </div>
                <div class="form-group">
                    <label for="apiHash">API Hash</label>
                    <input type="password" id="apiHash" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à API Hash">
                </div>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å API ID –∏ Hash?</strong><br>
                        1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ <a href="https://my.telegram.org" target="_blank">my.telegram.org</a><br>
                        2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —Å –≤–∞—à–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞<br>
                        3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "API Development Tools"<br>
                        4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ
                    </div>
                </div>
                <button class="btn btn-primary" onclick="saveApiCredentials()">
                    <i class="fas fa-arrow-right"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                </button>
                <div class="auth-footer">
                    –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ
                </div>
            </div>

            <!-- –§–æ—Ä–º–∞ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
            <div id="phoneForm" class="hidden">
                <div class="form-group">
                    <label for="phoneNumber">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                    <input type="tel" id="phoneNumber" class="form-control" placeholder="+79991234567" value="+7">
                </div>
                <button class="btn btn-primary" onclick="sendPhoneNumber()">
                    <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥
                </button>
                <button class="btn btn-secondary mt-20" onclick="showScreen('apiForm')">
                    <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                </button>
            </div>

            <!-- –§–æ—Ä–º–∞ –∫–æ–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
            <div id="codeForm" class="hidden">
                <div class="form-group">
                    <label for="code">–ö–æ–¥ –∏–∑ Telegram</label>
                    <div class="code-inputs">
                        <input type="text" maxlength="1" class="code-input" oninput="moveToNext(this, 1)">
                        <input type="text" maxlength="1" class="code-input" oninput="moveToNext(this, 2)">
                        <input type="text" maxlength="1" class="code-input" oninput="moveToNext(this, 3)">
                        <input type="text" maxlength="1" class="code-input" oninput="moveToNext(this, 4)">
                        <input type="text" maxlength="1" class="code-input" oninput="moveToNext(this, 5)">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="sendCode()">
                    <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                </button>
                <button class="btn btn-secondary mt-20" onclick="showScreen('phoneForm')">
                    <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                </button>
            </div>

            <!-- –§–æ—Ä–º–∞ –ø–∞—Ä–æ–ª—è 2FA -->
            <div id="passwordForm" class="hidden">
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="password" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å">
                        <button type="button" class="password-toggle" onclick="togglePassword()">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="sendPassword()">
                    <i class="fas fa-lock"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <div id="mainApp" class="app-container hidden">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-monkey"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Monkey Gram</h1>
                        <p>Online</p>
                    </div>
                </div>
            </div>

            <div class="sidebar-search">
                <div class="search-box">
                    <input type="text" placeholder="–ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π..." id="searchInput">
                    <i class="fas fa-search"></i>
                </div>
            </div>

            <div class="chats-list scrollbar-hide" id="chatsList">
                <!-- –ß–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç -->
        <div class="main-chat">
            <div class="chat-header">
                <div class="chat-user-info">
                    <div class="chat-avatar">
                        <div class="avatar-img" id="currentChatAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                    <div>
                        <div class="chat-name" id="currentChatName">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
                        <div class="user-status" id="currentChatStatus">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —á–∞—Ç —Å–ª–µ–≤–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—â–µ–Ω–∏—è</div>
                    </div>
                </div>
                <div class="chat-actions">
                    <button onclick="toggleTheme()">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button onclick="showSettings()">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>

            <div class="messages-container scrollbar-hide" id="messagesContainer">
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>

            <div class="input-container">
                <div class="input-actions">
                    <button onclick="toggleEmojiPicker()">
                        <i class="far fa-smile"></i>
                    </button>
                    <button onclick="attachFile()">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button onclick="attachPhoto()">
                        <i class="fas fa-camera"></i>
                    </button>
                </div>
                <div class="message-input-wrapper">
                    <div class="message-input">
                        <textarea id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                                  oninput="autoResize(this)" 
                                  onkeydown="handleKeyPress(event)"></textarea>
                        <button class="input-send" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –≠–º–æ–¥–∑–∏ –ø–∞–ª–∏—Ç—Ä–∞ -->
    <div class="emoji-picker" id="emojiPicker">
        <div class="d-flex justify-between align-center">
            <span>–≠–º–æ–¥–∑–∏</span>
            <button onclick="toggleEmojiPicker()" style="background: none; border: none; color: var(--gray);">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="emoji-grid" id="emojiGrid">
            <!-- –≠–º–æ–¥–∑–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                <button class="modal-close" onclick="hideModal('settingsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–¢–µ–º–∞</label>
                    <select id="themeSelect" class="form-control">
                        <option value="auto">–ê–≤—Ç–æ</option>
                        <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
                        <option value="dark">–¢–µ–º–Ω–∞—è</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                    <div>
                        <input type="checkbox" id="notificationsToggle" checked>
                        <label for="notificationsToggle">–í–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>–ö–∞—á–µ—Å—Ç–≤–æ –º–µ–¥–∏–∞</label>
                    <select id="mediaQuality" class="form-control">
                        <option value="low">–ù–∏–∑–∫–æ–µ</option>
                        <option value="medium" selected>–°—Ä–µ–¥–Ω–µ–µ</option>
                        <option value="high">–í—ã—Å–æ–∫–æ–µ</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('settingsModal')">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button class="btn btn-primary" onclick="saveSettings()">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ -->
    <div class="modal-overlay" id="attachModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª</div>
                <button class="modal-close" onclick="hideModal('attachModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="d-flex flex-column" style="gap: 15px;">
                    <button class="btn btn-secondary" onclick="attachFromDevice('photo')">
                        <i class="fas fa-image"></i> –§–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏
                    </button>
                    <button class="btn btn-secondary" onclick="attachFromDevice('document')">
                        <i class="fas fa-file"></i> –î–æ–∫—É–º–µ–Ω—Ç
                    </button>
                    <button class="btn btn-secondary" onclick="attachFromDevice('camera')">
                        <i class="fas fa-camera"></i> –°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ
                    </button>
                    <input type="file" id="fileInput" accept="image/*,video/*,.pdf,.doc,.docx" class="hidden" multiple>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ====== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ======
        let currentUser = null;
        let currentChat = null;
        let chats = [];
        let messages = new Map();
        let apiId = null;
        let apiHash = null;
        let phoneNumber = null;
        let phoneCodeHash = null;
        let sessionData = null;
        let isConnected = false;
        let messageQueue = [];
        let emojis = ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö', 'üòã', 'üòõ', 'üòù', 'üòú', 'ü§™', 'ü§®', 'üßê', 'ü§ì', 'üòé', 'ü§©', 'ü•≥', 'üòè', 'üòí', 'üòû', 'üòî', 'üòü', 'üòï', 'üôÅ', '‚òπÔ∏è', 'üò£', 'üòñ', 'üò´', 'üò©', 'ü•∫', 'üò¢', 'üò≠', 'üò§', 'üò†', 'üò°', 'ü§¨', 'ü§Ø', 'üò≥', 'ü•µ', 'ü•∂', 'üò±', 'üò®', 'üò∞', 'üò•', 'üòì', 'ü§ó', 'ü§î', 'ü§≠', 'ü§´', 'ü§•', 'üò∂', 'üòê', 'üòë', 'üò¨', 'üôÑ', 'üòØ', 'üò¶', 'üòß', 'üòÆ', 'üò≤', 'ü•±', 'üò¥', 'ü§§', 'üò™', 'üòµ', 'ü§ê', 'ü•¥', 'ü§¢', 'ü§Æ', 'ü§ß', 'üò∑', 'ü§í', 'ü§ï', 'ü§ë', 'ü§†', 'üòà', 'üëø', 'üëπ', 'üë∫', 'ü§°', 'üí©', 'üëª', 'üíÄ', '‚ò†Ô∏è', 'üëΩ', 'üëæ', 'ü§ñ', 'üéÉ', 'üò∫', 'üò∏', 'üòπ', 'üòª', 'üòº', 'üòΩ', 'üôÄ', 'üòø', 'üòæ'];

        // ====== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –≠–ú–û–î–ó–ò ======
        function initEmojiPicker() {
            const emojiGrid = document.getElementById('emojiGrid');
            emojis.forEach(emoji => {
                const emojiElement = document.createElement('div');
                emojiElement.className = 'emoji';
                emojiElement.textContent = emoji;
                emojiElement.onclick = () => insertEmoji(emoji);
                emojiGrid.appendChild(emojiElement);
            });
        }

        function toggleEmojiPicker() {
            const picker = document.getElementById('emojiPicker');
            picker.classList.toggle('active');
        }

        function insertEmoji(emoji) {
            const input = document.getElementById('messageInput');
            const cursorPos = input.selectionStart;
            const textBefore = input.value.substring(0, cursorPos);
            const textAfter = input.value.substring(cursorPos);
            input.value = textBefore + emoji + textAfter;
            input.focus();
            input.selectionStart = cursorPos + emoji.length;
            input.selectionEnd = cursorPos + emoji.length;
            autoResize(input);
        }

        // ====== –§–£–ù–ö–¶–ò–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ======
        async function loadFromStorage() {
            try {
                apiId = localStorage.getItem('monkey_api_id');
                apiHash = localStorage.getItem('monkey_api_hash');
                sessionData = localStorage.getItem('monkey_session');
                
                if (sessionData) {
                    showLoading();
                    await connectToTelegram();
                } else if (apiId && apiHash) {
                    showScreen('phoneForm');
                } else {
                    showScreen('apiForm');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showScreen('apiForm');
            }
        }

        function saveApiCredentials() {
            apiId = document.getElementById('apiId').value.trim();
            apiHash = document.getElementById('apiHash').value.trim();
            
            if (!apiId || !apiHash) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            localStorage.setItem('monkey_api_id', apiId);
            localStorage.setItem('monkey_api_hash', apiHash);
            showScreen('phoneForm');
        }

        async function sendPhoneNumber() {
            phoneNumber = document.getElementById('phoneNumber').value.trim();
            
            if (!phoneNumber || !phoneNumber.startsWith('+')) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, +79991234567)', 'error');
                return;
            }
            
            showLoading();
            
            try {
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞
                const response = await fetch('/api/send_code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        api_id: apiId,
                        api_hash: apiHash,
                        phone_number: phoneNumber
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    phoneCodeHash = data.phone_code_hash;
                    hideLoading();
                    showScreen('codeForm');
                    autoFocusCodeInputs();
                } else {
                    hideLoading();
                    showAlert(data.error || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞', 'error');
                }
            } catch (error) {
                hideLoading();
                showAlert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        function autoFocusCodeInputs() {
            setTimeout(() => {
                const firstInput = document.querySelector('.code-input');
                if (firstInput) firstInput.focus();
            }, 100);
        }

        function moveToNext(input, nextIndex) {
            if (input.value.length === 1) {
                const inputs = document.querySelectorAll('.code-input');
                if (nextIndex < inputs.length) {
                    inputs[nextIndex].focus();
                }
            }
        }

        async function sendCode() {
            const inputs = document.querySelectorAll('.code-input');
            const code = Array.from(inputs).map(input => input.value).join('');
            
            if (code.length !== 5) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ 5-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥', 'error');
                return;
            }
            
            showLoading();
            
            try {
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ API –¥–ª—è –≤—Ö–æ–¥–∞ –ø–æ –∫–æ–¥—É
                const response = await fetch('/api/sign_in', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        api_id: apiId,
                        api_hash: apiHash,
                        phone_number: phoneNumber,
                        phone_code_hash: phoneCodeHash,
                        code: code
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    if (data.requires_password) {
                        hideLoading();
                        showScreen('passwordForm');
                    } else {
                        localStorage.setItem('monkey_session', JSON.stringify(data.session));
                        await connectToTelegram();
                    }
                } else {
                    hideLoading();
                    showAlert(data.error || '–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥', 'error');
                }
            } catch (error) {
                hideLoading();
                showAlert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message, 'error');
            }
        }

        async function sendPassword() {
            const password = document.getElementById('password').value;
            
            if (!password) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å', 'error');
                return;
            }
            
            showLoading();
            
            try {
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ API –¥–ª—è –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è
                const response = await fetch('/api/sign_in_password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        api_id: apiId,
                        api_hash: apiHash,
                        phone_number: phoneNumber,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    localStorage.setItem('monkey_session', JSON.stringify(data.session));
                    await connectToTelegram();
                } else {
                    hideLoading();
                    showAlert(data.error || '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', 'error');
                }
            } catch (error) {
                hideLoading();
                showAlert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message, 'error');
            }
        }

        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleButton = passwordInput.nextElementSibling;
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.innerHTML = '<i class="fas fa-eye-slash"></i>';
            } else {
                passwordInput.type = 'password';
                toggleButton.innerHTML = '<i class="fas fa-eye"></i>';
            }
        }

        // ====== –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö TELEGRAM ======
        async function connectToTelegram() {
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                await initWebSocket();
                isConnected = true;
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await loadUserData();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤
                await loadChats();
                
                hideLoading();
                showMainApp();
                
                // –ù–∞—á–∏–Ω–∞–µ–º —Å–ª—É—à–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                startPolling();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
                showAlert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram', 'error');
                localStorage.removeItem('monkey_session');
                hideLoading();
                showScreen('apiForm');
            }
        }

        async function initWebSocket() {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±—ç–∫–µ–Ω–¥—É
            return new Promise((resolve) => {
                setTimeout(resolve, 1000); // –ó–∞–≥–ª—É—à–∫–∞
            });
        }

        async function loadUserData() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            currentUser = {
                id: 1,
                first_name: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                username: 'user',
                phone_number: phoneNumber
            };
        }

        async function loadChats() {
            try {
                // –ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤ —Å —Å–µ—Ä–≤–µ—Ä–∞
                const response = await fetch('/api/get_chats');
                const data = await response.json();
                
                if (data.success) {
                    chats = data.chats;
                    renderChatsList();
                    
                    // –ï—Å–ª–∏ –µ—Å—Ç—å —á–∞—Ç—ã, –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π
                    if (chats.length > 0) {
                        selectChat(chats[0]);
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤:', error);
                // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                loadMockChats();
            }
        }

        function loadMockChats() {
            chats = [
                {
                    id: 1,
                    type: 'private',
                    title: '–ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤',
                    username: 'alexey',
                    last_message: { text: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?', date: new Date() },
                    unread_count: 2,
                    is_online: true
                },
                {
                    id: 2,
                    type: 'private',
                    title: '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞',
                    username: 'maria',
                    last_message: { text: '–û—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ –∑–∞–≤—Ç—Ä–∞', date: new Date(Date.now() - 3600000) },
                    unread_count: 0,
                    is_online: false
                },
                {
                    id: 3,
                    type: 'group',
                    title: '–†–∞–±–æ—á–∞—è –≥—Ä—É–ø–ø–∞',
                    members_count: 15,
                    last_message: { text: '–ó–∞–≤—Ç—Ä–∞ —Å–æ–≤–µ—â–∞–Ω–∏–µ –≤ 10:00', date: new Date(Date.now() - 86400000) },
                    unread_count: 5
                },
                {
                    id: 4,
                    type: 'channel',
                    title: '–ù–æ–≤–æ—Å—Ç–∏ IT',
                    last_message: { text: '–í—ã—à–µ–ª –Ω–æ–≤—ã–π Python 3.12!', date: new Date(Date.now() - 172800000) },
                    unread_count: 0
                }
            ];
            
            renderChatsList();
        }

        // ====== –†–ï–ù–î–ï–†–ò–ù–ì –ò–ù–¢–ï–†–§–ï–ô–°–ê ======
        function renderChatsList() {
            const chatsList = document.getElementById('chatsList');
            chatsList.innerHTML = '';
            
            chats.forEach(chat => {
                const chatElement = document.createElement('div');
                chatElement.className = 'chat-item';
                if (currentChat && currentChat.id === chat.id) {
                    chatElement.classList.add('active');
                }
                chatElement.onclick = () => selectChat(chat);
                
                const lastMessageDate = new Date(chat.last_message.date);
                const timeString = formatTime(lastMessageDate);
                
                let avatarText = '';
                if (chat.type === 'private') {
                    const words = chat.title.split(' ');
                    avatarText = (words[0][0] + (words[1] ? words[1][0] : words[0][1])).toUpperCase();
                } else {
                    avatarText = chat.title.substring(0, 2).toUpperCase();
                }
                
                chatElement.innerHTML = `
                    <div class="chat-avatar">
                        <div class="avatar-img" style="background: ${getAvatarColor(chat.id)};">
                            ${avatarText}
                        </div>
                        ${chat.is_online ? '<div class="online-status"></div>' : ''}
                    </div>
                    <div class="chat-info">
                        <div class="chat-name">
                            <span>${escapeHtml(chat.title)}</span>
                            <span class="chat-time">${timeString}</span>
                        </div>
                        <div class="last-message">
                            ${getLastMessagePreview(chat)}
                        </div>
                    </div>
                    ${chat.unread_count > 0 ? `<div class="unread-badge">${chat.unread_count}</div>` : ''}
                `;
                
                chatsList.appendChild(chatElement);
            });
        }

        async function selectChat(chat) {
            currentChat = chat;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
            document.getElementById('currentChatName').textContent = chat.title;
            
            let statusText = '';
            if (chat.type === 'private') {
                statusText = chat.is_online ? 'online' : '–±—ã–ª(–∞) –Ω–µ–¥–∞–≤–Ω–æ';
            } else if (chat.type === 'group') {
                statusText = `${chat.members_count} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`;
            } else if (chat.type === 'channel') {
                statusText = '–ö–∞–Ω–∞–ª';
            }
            document.getElementById('currentChatStatus').textContent = statusText;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä
            const avatarElement = document.getElementById('currentChatAvatar');
            if (chat.type === 'private') {
                const words = chat.title.split(' ');
                avatarElement.innerHTML = (words[0][0] + (words[1] ? words[1][0] : words[0][1])).toUpperCase();
            } else {
                avatarElement.innerHTML = chat.title.substring(0, 2).toUpperCase();
            }
            avatarElement.style.background = getAvatarColor(chat.id);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            await loadMessages(chat.id);
            
            // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('messageInput').focus();
        }

        async function loadMessages(chatId) {
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.innerHTML = '<div class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π...</div>';
            
            try {
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Å–µ—Ä–≤–µ—Ä–∞
                const response = await fetch(`/api/get_messages?chat_id=${chatId}`);
                const data = await response.json();
                
                if (data.success) {
                    messages.set(chatId, data.messages);
                    renderMessages(chatId);
                } else {
                    // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                    loadMockMessages(chatId);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
                loadMockMessages(chatId);
            }
        }

        function loadMockMessages(chatId) {
            const mockMessages = [
                {
                    id: 1,
                    text: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
                    date: new Date(Date.now() - 3600000),
                    outgoing: false,
                    read: true
                },
                {
                    id: 2,
                    text: '–ü—Ä–∏–≤–µ—Ç! –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ! –ê —É —Ç–µ–±—è –∫–∞–∫?',
                    date: new Date(Date.now() - 3500000),
                    outgoing: true,
                    read: true
                },
                {
                    id: 3,
                    text: '–¢–æ–∂–µ —Ö–æ—Ä–æ—à–æ. –ß—Ç–æ –Ω–∞—Å—á–µ—Ç –≤—Å—Ç—Ä–µ—á–∏ –≤ –ø—è—Ç–Ω–∏—Ü—É?',
                    date: new Date(Date.now() - 3400000),
                    outgoing: false,
                    read: true
                },
                {
                    id: 4,
                    text: '–û—Ç–ª–∏—á–Ω–æ! –í 15:00 –ø–æ–¥–æ–π–¥—ë—Ç?',
                    date: new Date(Date.now() - 3300000),
                    outgoing: true,
                    read: true
                },
                {
                    id: 5,
                    text: '–î–∞, –∏–¥–µ–∞–ª—å–Ω–æ! –£–≤–∏–¥–∏–º—Å—è –≤ –ø—è—Ç–Ω–∏—Ü—É –≤ 15:00',
                    date: new Date(Date.now() - 3200000),
                    outgoing: false,
                    read: true
                },
                {
                    id: 6,
                    text: '–û—Ç–ø—Ä–∞–≤–∏–ª —Ç–µ–±–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ –ø—Ä–æ–µ–∫—Ç—É. –ü–æ—Å–º–æ—Ç—Ä–∏, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.',
                    date: new Date(Date.now() - 3000000),
                    outgoing: true,
                    read: false
                }
            ];
            
            messages.set(chatId, mockMessages);
            renderMessages(chatId);
        }

        function renderMessages(chatId) {
            const messagesList = messages.get(chatId) || [];
            const messagesContainer = document.getElementById('messagesContainer');
            
            if (messagesList.length === 0) {
                messagesContainer.innerHTML = '<div class="text-center">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>';
                return;
            }
            
            let html = '';
            let currentDate = null;
            
            messagesList.forEach(message => {
                const messageDate = new Date(message.date);
                const messageDay = messageDate.toDateString();
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–∞—Ç—ã
                if (!currentDate || currentDate !== messageDay) {
                    currentDate = messageDay;
                    const dateString = formatDate(messageDate);
                    html += `<div class="date-divider"><span>${dateString}</span></div>`;
                }
                
                const timeString = formatTime(messageDate);
                const statusIcon = message.outgoing ? 
                    (message.read ? '<i class="fas fa-check-double message-status read"></i>' : 
                     '<i class="fas fa-check message-status"></i>') : '';
                
                html += `
                    <div class="message ${message.outgoing ? 'outgoing' : 'incoming'}">
                        <div class="message-content">
                            <div class="message-text">${escapeHtml(message.text)}</div>
                            <div class="message-time">
                                ${timeString}
                                ${statusIcon}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            messagesContainer.innerHTML = html;
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 100);
        }

        // ====== –û–¢–ü–†–ê–í–ö–ê –°–û–û–ë–©–ï–ù–ò–ô ======
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text || !currentChat) {
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            const tempMessage = {
                id: Date.now(),
                text: text,
                date: new Date(),
                outgoing: true,
                read: false
            };
            
            if (!messages.has(currentChat.id)) {
                messages.set(currentChat.id, []);
            }
            messages.get(currentChat.id).push(tempMessage);
            renderMessages(currentChat.id);
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            input.value = '';
            autoResize(input);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            try {
                const response = await fetch('/api/send_message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: currentChat.id,
                        text: text
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º ID
                    const messagesList = messages.get(currentChat.id);
                    const messageIndex = messagesList.findIndex(m => m.id === tempMessage.id);
                    if (messageIndex !== -1) {
                        messagesList[messageIndex] = {
                            ...data.message,
                            outgoing: true,
                            read: true
                        };
                        renderMessages(currentChat.id);
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
        }

        // ====== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ======
        function showScreen(screenName) {
            document.querySelectorAll('#authScreen > div > div').forEach(div => {
                div.classList.add('hidden');
            });
            document.getElementById(screenName).classList.remove('hidden');
        }

        function showLoading() {
            document.getElementById('loadingScreen').classList.remove('hidden');
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingScreen').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }

        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 
                                 type === 'success' ? 'check-circle' : 
                                 type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <div>${escapeHtml(message)}</div>
            `;
            
            const authContainer = document.querySelector('.auth-container');
            authContainer.insertBefore(alertDiv, authContainer.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        function formatDate(date) {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (date.toDateString() === today.toDateString()) {
                return '–°–µ–≥–æ–¥–Ω—è';
            } else if (date.toDateString() === yesterday.toDateString()) {
                return '–í—á–µ—Ä–∞';
            } else {
                return date.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'long'
                });
            }
        }

        function formatTime(date) {
            return date.toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function getLastMessagePreview(chat) {
            if (!chat.last_message) return '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π';
            
            const text = chat.last_message.text || '';
            if (text.length > 30) {
                return escapeHtml(text.substring(0, 30) + '...');
            }
            return escapeHtml(text);
        }

        function getAvatarColor(id) {
            const colors = [
                'linear-gradient(135deg, #FF6B35 0%, #FF8B5C 100%)',
                'linear-gradient(135deg, #4ECDC4 0%, #6EE7E7 100%)',
                'linear-gradient(135deg, #9D50BB 0%, #6E48AA 100%)',
                'linear-gradient(135deg, #FF5E62 0%, #FF9966 100%)',
                'linear-gradient(135deg, #42E695 0%, #3BB2B8 100%)',
                'linear-gradient(135deg, #667EEA 0%, #764BA2 100%)',
                'linear-gradient(135deg, #F093FB 0%, #F5576C 100%)',
                'linear-gradient(135deg, #4FACFE 0%, #00F2FE 100%)'
            ];
            return colors[id % colors.length];
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ====== –§–£–ù–ö–¶–ò–ò –ù–ê–°–¢–†–û–ï–ö ======
        function toggleTheme() {
            const body = document.body;
            const currentTheme = localStorage.getItem('monkey_theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('monkey_theme', newTheme);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
            const icon = document.querySelector('.chat-actions button:nth-child(1) i');
            icon.className = newTheme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
        }

        function showSettings() {
            showModal('settingsModal');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const theme = localStorage.getItem('monkey_theme') || 'auto';
            const notifications = localStorage.getItem('monkey_notifications') !== 'false';
            const mediaQuality = localStorage.getItem('monkey_media_quality') || 'medium';
            
            document.getElementById('themeSelect').value = theme;
            document.getElementById('notificationsToggle').checked = notifications;
            document.getElementById('mediaQuality').value = mediaQuality;
        }

        function saveSettings() {
            const theme = document.getElementById('themeSelect').value;
            const notifications = document.getElementById('notificationsToggle').checked;
            const mediaQuality = document.getElementById('mediaQuality').value;
            
            localStorage.setItem('monkey_theme', theme);
            localStorage.setItem('monkey_notifications', notifications);
            localStorage.setItem('monkey_media_quality', mediaQuality);
            
            hideModal('settingsModal');
            showAlert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
        }

        // ====== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –§–ê–ô–õ–û–í ======
        function attachFile() {
            showModal('attachModal');
        }

        function attachPhoto() {
            const input = document.getElementById('fileInput');
            input.accept = 'image/*';
            input.click();
        }

        function attachFromDevice(type) {
            const input = document.getElementById('fileInput');
            
            if (type === 'photo') {
                input.accept = 'image/*';
            } else if (type === 'document') {
                input.accept = '.pdf,.doc,.docx,.txt,.zip,.rar';
            } else if (type === 'camera') {
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ
                alert('–§—É–Ω–∫—Ü–∏—è –∫–∞–º–µ—Ä—ã –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö');
                return;
            }
            
            input.onchange = async (event) => {
                const files = event.target.files;
                if (files.length > 0) {
                    await sendFiles(files);
                }
                hideModal('attachModal');
            };
            
            input.click();
        }

        async function sendFiles(files) {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤
            showAlert(`${files.length} —Ñ–∞–π–ª(–æ–≤) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è...`, 'info');
        }

        // ====== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ======
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        // ====== POLLING –î–õ–Ø –ù–û–í–´–• –°–û–û–ë–©–ï–ù–ò–ô ======
        function startPolling() {
            setInterval(async () => {
                if (isConnected) {
                    await checkNewMessages();
                }
            }, 3000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
        }

        async function checkNewMessages() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
                const response = await fetch('/api/check_updates');
                const data = await response.json();
                
                if (data.success && data.updates) {
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    data.updates.forEach(update => {
                        if (update.type === 'new_message') {
                            handleNewMessage(update.message);
                        }
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:', error);
            }
        }

        function handleNewMessage(message) {
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —á–∞—Ç
            if (!messages.has(message.chat_id)) {
                messages.set(message.chat_id, []);
            }
            
            const chatMessages = messages.get(message.chat_id);
            if (!chatMessages.some(m => m.id === message.id)) {
                chatMessages.push({
                    ...message,
                    outgoing: false,
                    read: true
                });
                
                // –ï—Å–ª–∏ —ç—Ç–æ—Ç —á–∞—Ç –∞–∫—Ç–∏–≤–µ–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
                if (currentChat && currentChat.id === message.chat_id) {
                    renderMessages(currentChat.id);
                } else {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
                    updateChatUnreadCount(message.chat_id);
                }
            }
        }

        function updateChatUnreadCount(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (chat) {
                chat.unread_count = (chat.unread_count || 0) + 1;
                renderChatsList();
            }
        }

        // ====== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ======
        function init() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–º—É
            const savedTheme = localStorage.getItem('monkey_theme') || 'dark';
            document.body.setAttribute('data-theme', savedTheme);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —ç–º–æ–¥–∑–∏ –ø–∞–ª–∏—Ç—Ä—É
            initEmojiPicker();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            setTimeout(() => {
                loadFromStorage();
            }, 1000); // –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –æ–≤–µ—Ä–ª–µ–π
            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (event) => {
                    if (event.target === overlay) {
                        overlay.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            });
            
            // –ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤
            document.getElementById('searchInput').addEventListener('input', (event) => {
                const searchTerm = event.target.value.toLowerCase();
                filterChats(searchTerm);
            });
        }

        function filterChats(searchTerm) {
            const chatItems = document.querySelectorAll('.chat-item');
            chatItems.forEach(item => {
                const chatName = item.querySelector('.chat-name span').textContent.toLowerCase();
                const lastMessage = item.querySelector('.last-message').textContent.toLowerCase();
                
                if (chatName.includes(searchTerm) || lastMessage.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
